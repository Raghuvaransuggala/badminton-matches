<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üè∏ Team Matches</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #eaf7e2;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #1b5e20;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    button {
      background-color: #388e3c;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background-color: #2e7d32;
    }
    input[type="text"] {
      padding: 6px;
      border-radius: 4px;
      border: 1px solid #ccc;
      width: 250px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      border: 1px solid #c8e6c9;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #a5d6a7;
      color: #1b5e20;
    }
    td[contenteditable="true"] {
      background-color: #f5fff5;
    }
  </style>
</head>
<body>
  <h1>üè∏ Team Matches</h1>

  <div class="controls">
    <input type="text" id="search" placeholder="Search player name..." />
    <div>
      <button id="refresh">üîÑ Refresh</button>
      <button id="save">üíæ Save Changes</button>
    </div>
  </div>

  <table id="matchesTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Team A P1</th>
        <th>Team A P2</th>
        <th>Team B P1</th>
        <th>Team B P2</th>
        <th>Time</th>
        <th>Court</th>
        <th>Team Won</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const scriptURL =
      "https://script.google.com/macros/s/AKfycbxqIh5Rr_kQsUkA06vlty9Jo2fnDeAtkURrEAMMsrGh-4wkbSuNyFBc7bv0xTIiYJ3YSA/exec";

    const tableBody = document.querySelector("#matchesTable tbody");
    const searchInput = document.getElementById("search");
    let currentData = [];

    async function loadData() {
      try {
        const res = await fetch(scriptURL + "?t=" + Date.now(), { mode: "cors" });
        const data = await res.json();
        currentData = data;
        renderTable(data);
      } catch (err) {
        console.error("Error loading data:", err);
        alert("‚ö†Ô∏è Unable to load match data. Please check your script permissions.");
      }
    }

    function renderTable(data) {
      const searchTerm = searchInput.value.toLowerCase();
      const filtered = data.filter(row =>
        Object.values(row).some(v => v && v.toString().toLowerCase().includes(searchTerm))
      );
      tableBody.innerHTML = "";
      filtered.forEach((row, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td contenteditable="true">${row["#"] || i + 1}</td>
          <td contenteditable="true">${row["Team A P1"] || ""}</td>
          <td contenteditable="true">${row["Team A P2"] || ""}</td>
          <td contenteditable="true">${row["Team B P1"] || ""}</td>
          <td contenteditable="true">${row["Team B P2"] || ""}</td>
          <td contenteditable="true">${row["Time"] || ""}</td>
          <td contenteditable="true">${row["Court"] || ""}</td>
          <td>
            <select>
              <option value="">--Select--</option>
              <option value="Team A" ${row["Team Won"] === "Team A" ? "selected" : ""}>Team A</option>
              <option value="Team B" ${row["Team Won"] === "Team B" ? "selected" : ""}>Team B</option>
            </select>
          </td>
        `;
        tableBody.appendChild(tr);
      });
    }

    async function saveData() {
      const rows = [...tableBody.querySelectorAll("tr")];
      const newData = rows.map(r => {
        const cells = r.querySelectorAll("td");
        const select = r.querySelector("select");
        return {
          "#": cells[0].innerText.trim(),
          "Team A P1": cells[1].innerText.trim(),
          "Team A P2": cells[2].innerText.trim(),
          "Team B P1": cells[3].innerText.trim(),
          "Team B P2": cells[4].innerText.trim(),
          "Time": cells[5].innerText.trim(),
          "Court": cells[6].innerText.trim(),
          "Team Won": select ? select.value : ""
        };
      });

      try {
        await fetch(scriptURL, {
          method: "POST",
          mode: "cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(newData)
        });
        alert("‚úÖ Matches updated successfully in Google Sheet!");
        loadData();
      } catch (err) {
        console.error("Error saving data:", err);
        alert("‚ö†Ô∏è Error saving data. Please try again.");
      }
    }

    document.getElementById("refresh").addEventListener("click", loadData);
    document.getElementById("save").addEventListener("click", saveData);
    searchInput.addEventListener("input", () => renderTable(currentData));

    loadData();
  </script>
</body>
</html>
